import{a as Qe}from"/build/_shared/chunk-SNSPQP6N.js";import{a as Ce,b as De}from"/build/_shared/chunk-QVX2WIMK.js";import"/build/_shared/chunk-A2BHRVJT.js";import{a as ze}from"/build/_shared/chunk-SMIP5KQV.js";import{a as Me}from"/build/_shared/chunk-IMEDTRKH.js";import{b as Ne,j as ke}from"/build/_shared/chunk-6CXZSVOP.js";import{a as ye,b as se}from"/build/_shared/chunk-PRH7VUOP.js";import{b as Ie,c as h,e as p,f as m,g as v,i as g,j as b}from"/build/_shared/chunk-E5IAN4VW.js";var Ee=Ie((tt,_e)=>{p();m();v();b();g();_e.exports={}});var Be=Ie((Rt,qe)=>{p();m();v();b();g();qe.exports={}});p();m();v();b();g();p();m();v();b();g();p();m();v();b();g();var t=h(ye()),ae=h(Qe());p();m();v();b();g();function Oe(e,u){AWS.config.update({region:"us-east-1"}),AWS.config.region="us-east-1",AWS.config.credentials=new AWS.CognitoIdentityCredentials({IdentityPoolId:"us-east-1:f76af4b2-04c2-46e4-b76b-2b19cf73204b"}),AWS.config.apiVersions={s3:"2006-03-01"};var o=new AWS.S3({params:{Bucket:"wizetalk"}});o.putObject({Key:u,Body:e,ContentType:"video/mp4"},a=>{console.log(a||"S3 Success")})}var ut=h(Ee());var k=h(se());function xe(){let[e,u]=(0,t.useState)(!1),[o,a]=(0,t.useState)(!1),d=(0,t.useRef)(null),r=(0,t.useRef)(null),A=(0,t.useRef)(null),I=(0,t.useRef)([]),[K,q]=(0,t.useState)(!1),[J,U]=(0,t.useState)(""),[Y,B]=(0,t.useState)(""),[C,X]=(0,t.useState)(""),[D,L]=(0,t.useState)(""),[G,s]=(0,t.useState)([]),[E,j]=(0,t.useState)([]),[T,Z]=(0,t.useState)(null),[ee,F]=(0,t.useState)(null),[c,P]=(0,t.useState)(""),[he,we]=(0,t.useState)(!1),[l,S]=(0,t.useState)(0),[ce,Pe]=(0,t.useState)(null),n=(0,t.useContext)(H),[Se,Ue]=(0,t.useState)(null);function Le(){e||r.current&&(A.current=new MediaRecorder(r.current),A.current.start(),A.current.ondataavailable=function(R){I.current&&(I.current.push(R.data),a(!0))},Ue(n.question.id),u(!0),console.log(n.question.max_time),console.log("Recording..."),n.setIsRecording(!0))}function ue(R){return new Promise(te=>setTimeout(te,R))}(0,t.useEffect)(function(){async function R(){await ue(1e3),e&&l>=0&&l<n.question.min_time?(S(l+1),console.log("Stop 1")):l>=n.question.min_time&&n.isNextAvailable==!1&&n.isRecording?(console.log("Can Stop"),n.setIsNextAvailable(!0),S(l+1),console.log("Stop 2")):l>=n.question.min_time&&n.isRecording&&l<n.question.max_time?(S(l+1),console.log("Stop 3")):l>=n.question.min_time&&l<n.question.max_time&&!n.isRecording?(le(),console.log("Stop 4")):l==n.question.max_time&&(console.log("Max time reached"),le())}R()},[e,l]),(0,t.useEffect)(function(){async function R(){await ue(n.question.max_time*1e3),e&&n.question.max_time<=l&&(le(),n.setIsNextAvailable(!0))}n.isAudioDone==!0&&n.isRecording==!1&&n.isNextAvailable==!1&&(Le(),R(),console.log("Recording"))},[n]),(0,t.useEffect)(function(){let R=new ae.Configuration({apiKey:"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"}),te=new ae.OpenAIApi(R),de="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",fe="https://api.openai.com/v1/audio/transcriptions";async function pe(_){return new Promise(ve=>{let N=document.createElement("video"),M=URL.createObjectURL(_);N.src=M,N.onloadedmetadata=async()=>{N.currentTime=Math.min(60,N.duration),await ue(1e3);let ge=new AudioContext,Te=ge.createMediaElementSource(N),Re=ge.createMediaStreamDestination();Te.connect(Re);let ie=new MediaRecorder(Re.stream),Ae=[];ie.ondataavailable=be=>{Ae.push(be.data)},ie.onstop=()=>{let be=new Blob(Ae,{type:"audio/mp3"});ve(be)},ie.start(),setTimeout(()=>{ie.stop()},60*1e3)}})}async function me(_){async function ve(M){let ne=URL.createObjectURL(M);new Howl({src:[ne],format:["mp3"]}).play()}let N=new FormData;N.append("file",_,"audio.mp3"),N.append("model","whisper-1"),N.append("language","en");try{ve(_);let ne=await(await fetch(fe,{method:"POST",headers:{Authorization:`Bearer ${de}`},body:N})).json();console.log(ne)}catch(M){console.error("Error:",M)}}if(e||I.current.length===0||!o)return;let x=new Blob(I.current,{type:"video/mp4"}),y=new Blob(I.current,{type:"audio/mpeg"});U(URL.createObjectURL(x)),B(URL.createObjectURL(y)),Pe(x),F(y);let oe=n.userId+"_"+Se+".mp4";console.log(Se,n.question.audio_path),Oe(x,oe),pe(x).then(_=>{_&&me(_)}).catch(_=>{console.error("Error converting video format:",_)}),I.current=[],a(!1),q(!0),x.lastModified=new Date;let O=new File([y],"question.mpeg",{type:y.type})},[o]);async function le(){A.current&&(A.current.stop(),S(0),u(!1),n.setIsRecording(!1),console.log("Stop Recording"),console.log(ce),console.log("Stopped audioContext ",H.audio),a(!1))}return(0,t.useEffect)(function(){async function R(){function te(x){r.current=x,d.current&&(d.current.srcObject=x)}async function de(){r.current&&r.current.getTracks().forEach(y=>{y.stop()});let x={audio:{deviceId:C!==""?{exact:C}:void 0},video:{deviceId:D!==""?{exact:D}:void 0}};try{let y=await navigator.mediaDevices.getUserMedia(x);te(y)}catch(y){Z(y)}}function fe(){return navigator.mediaDevices.enumerateDevices()}function pe(x){let y=[],oe=[];for(let O of x)O.kind==="audioinput"?y.push({value:O.deviceId,label:O.label||`Microphone ${O.deviceId}`}):O.kind==="videoinput"&&oe.push({value:O.deviceId,label:O.label||`Camera ${O.deviceId}`});s(y),j(oe)}await de();let me=await fe();pe(me)}R()},[C,D]),(0,k.jsxs)("div",{children:[(0,k.jsx)("script",{src:"https://sdk.amazonaws.com/js/aws-sdk-2.283.1.min.js"}),(0,k.jsx)("div",{children:(0,k.jsx)("video",{className:"h-72",ref:d,autoPlay:!0,muted:!0,playsInline:!0})}),(0,k.jsx)("div",{children:l}),(0,k.jsx)("div",{children:T&&(0,k.jsx)("p",{children:T.message})}),(0,k.jsx)("script",{src:"https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"})]})}var f=h(ye());p();m();v();b();g();var w=h(ye());function re(){return re=Object.assign||function(e){for(var u=1;u<arguments.length;u++){var o=arguments[u];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e},re.apply(this,arguments)}function Ve(e,u){if(e==null)return{};var o={},a=Object.keys(e),d,r;for(r=0;r<a.length;r++)d=a[r],!(u.indexOf(d)>=0)&&(o[d]=e[d]);return o}function We(e){(0,w.useEffect)(e,[])}function $e(e,u){u===void 0&&(u={});var o=u,a=o.volume,d=a===void 0?1:a,r=o.playbackRate,A=r===void 0?1:r,I=o.soundEnabled,K=I===void 0?!0:I,q=o.interrupt,J=q===void 0?!1:q,U=o.onload,Y=Ve(o,["id","volume","playbackRate","soundEnabled","interrupt","onload"]),B=w.default.useRef(null),C=w.default.useRef(!1),X=w.default.useState(null),D=X[0],L=X[1],G=w.default.useState(null),s=G[0],E=G[1],j=function(){typeof U=="function"&&U.call(this),C.current&&L(this.duration()*1e3),E(this)};We(function(){return import("/build/_shared/howler-QJ6SUHQJ.js").then(function(c){if(!C.current){var P;B.current=(P=c.Howl)!==null&&P!==void 0?P:c.default.Howl,C.current=!0,new B.current(re({src:Array.isArray(e)?e:[e],volume:d,rate:A,onload:j},Y))}}),function(){C.current=!1}}),w.default.useEffect(function(){B.current&&s&&E(new B.current(re({src:Array.isArray(e)?e:[e],volume:d,onload:j},Y)))},[JSON.stringify(e)]),w.default.useEffect(function(){s&&(s.volume(d),s.rate(A))},[d,A]);var T=w.default.useCallback(function(c){typeof c>"u"&&(c={}),!(!s||!K&&!c.forceSoundEnabled)&&(J&&s.stop(),c.playbackRate&&s.rate(c.playbackRate),s.play(c.id))},[s,K,J]),Z=w.default.useCallback(function(c){s&&s.stop(c)},[s]),ee=w.default.useCallback(function(c){s&&s.pause(c)},[s]),F=[T,{sound:s,stop:Z,pause:ee,duration:D}];return F}var je=$e;var Ke=h(Be()),Je=h(Me()),jt=h(ze()),i=h(se()),H=(0,f.createContext)({isAudioDone:!1});function Fe(){let[e,u]=ke(),[o,a]=(0,f.useState)(0),[d,r]=(0,f.useState)(!1),[A,I]=(0,f.useState)(!1),[K,q]=(0,f.useState)(),[J,U]=(0,f.useState)(e[0].audio_path),[Y,B]=(0,f.useState)(!1),[C,X]=(0,f.useState)(!1),[D,L]=(0,f.useState)(!1),[G,s]=(0,f.useState)(!1),[E,j]=(0,f.useState)(!1),[T,{pause:Z,duration:ee,sound:F}]=je(J,{onend:()=>{console.log("Audio finished"),s(!0)}}),c=Ne(),P=()=>{let S=o+1;U(e[S].audio_path),r(!1),a(S),q(0),s(!1),D&&L(!1),j(!1)};async function he(){r(!0),T()}function we(S){return new Promise(ce=>setTimeout(ce,S))}let l=async()=>{D&&L(!1),j(!1),r(!1),s(!1),await we(3e3),c("/evaluation/results")};return(0,f.useEffect)(()=>{let S=setInterval(()=>{F&&q(F.seek([]))},500);return()=>clearInterval(S)},[F]),(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("section",{className:"flex flex-col justify-between",children:[(0,i.jsxs)("div",{className:"my-[1%]",children:[(0,i.jsx)("div",{className:"flex justify-center mx-[20%] py-5",children:(0,i.jsxs)("h1",{className:"text-center font-sans text-lg font-bold",children:["Q",o+1,". ",e[o].instructions]})}),(0,i.jsxs)("div",{className:"flex justify-center drop-shadow-xl h-16 bg-white mx-[35%] items-center rounded-lg px-5",children:[d?(0,i.jsx)(De,{size:40,color:"#43C2FF"}):(0,i.jsx)("button",{onClick:he,children:(0,i.jsx)(Ce,{size:40,color:"#43C2FF"})}),(0,i.jsx)("input",{className:"w-[60%]",type:"range",value:K,disabled:!0,max:Math.ceil(ee/1e3)})]})]}),(0,i.jsx)(H.Provider,{value:{isAudioDone:G,isRecording:D,setIsRecording:L,isNextAvailable:E,setIsNextAvailable:j,question:e[o],nextQuestion:P,userId:u},children:(0,i.jsx)("div",{className:"flex justify-center my-[3%] rounded-md",children:(0,i.jsx)(xe,{})})}),(0,i.jsxs)("div",{className:"flex justify-center",children:[(0,i.jsxs)("div",{className:"inline-flex items-center px-4 py-2 mr-3 text-sm font-medium text-white bg-wizeblue-100 border border-gray-300 rounded-lg",children:[o+1," / ",e.length]}),e[o+1]!==void 0?(0,i.jsxs)("button",{disabled:!E,onClick:()=>P(),className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 hover:text-gray-700",children:["Next ",H.time,(0,i.jsx)("svg",{"aria-hidden":"true",className:"w-5 h-5 ml-2",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z",clipRule:"evenodd"})})]}):(0,i.jsx)("button",{disabled:!E,onClick:()=>l(),className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 hover:text-gray-700",children:"End Test"})]}),(0,i.jsx)("a",{children:E})]})})}export{Fe as default};
